<!DOCTYPE html><p><a href="https://dns.surf/">DNS.Surf</a> runs 100% on Vercel, so Vercel Analytics is used for access statistics. However, many users who have AdBlock installed experience issues with access statistics not being recorded. Today, we will solve the problem of AdBlock blocking access statistics, while still relying on Vercel 100%.</p>
<p>The core principle of AdBlock is to block certain network requests and page elements using rules. Vercel Analytics is blocked by the rule <code>/_vercel/insights/script.js</code>, and it may also block <code>/_vercel/insights/event</code>. To solve this problem, we just need to make these two URLs less recognizable.</p>
<p><img src="https://static.miantiao.me/share/2024/JbSVLo/5aOZdV.png" alt="/_vercel/insights/script.js"></p>
<h2 id="solution">Solution</h2>
<p>Vercel comes with a Rewrite feature, so we just need to rewrite the disguised path <code>/mt-demo</code> to <code>/_vercel/insights</code>. The disguised path can be any unique path that does not conflict with existing paths. If it gets blocked, just use a different one. The vercel.json configuration is as follows:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#9ECBFF">  "rewrites"</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#9ECBFF">      "source"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"/mt-demo/:match*"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">      "destination"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"https://dns.surf/_vercel/insights/:match*"</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  ]</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Note that the destination should be the complete URL, otherwise it will not work.</p>
<p>In the official tutorial, different frameworks use <a href="https://vercel.com/docs/analytics/package">@vercel/analytics</a> to inject the analytics script into the page, but it does not support custom scripts and data reporting URLs. Therefore, we need to use the HTML method to inject the script.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">script</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  window.va </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> window.va </span><span style="color:#F97583">||</span><span style="color:#F97583"> function</span><span style="color:#E1E4E8"> () { (window.vaq </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> window.vaq </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> []).</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">arguments</span><span style="color:#E1E4E8">); };</span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">script</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">script</span><span style="color:#B392F0"> async</span><span style="color:#B392F0"> src</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"/mt-demo/script.js"</span><span style="color:#B392F0"> data-endpoint</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"/mt-demo"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">script</span><span style="color:#E1E4E8">></span></span></code></pre>
<p><code>src</code> is the script URL, and <code>data-endpoint</code> is the data reporting URL. Although it is not mentioned in the official documentation, the script does support it. Remember to replace <code>mt-demo</code> with your disguised path.</p>
<p>If you are using a different framework, you can look for the method to inject scripts in that framework to adapt it to your own usage.</p>
<p>You can verify the effect using <a href="https://dns.surf/">DNS.Surf</a>.</p>