<!DOCTYPE html><p>Previously, I shared an article on <a href="https://dev.to/ccbikai/shi-yong-cloudflare-worker-chu-li-tu-pian-38dl-temp-slug-7437591">using Cloudflare Worker to process images</a>. However, due to the limitations of the free version of Worker, which only allows for 10ms of CPU usage, there were frequent resource overages and high failure rates. Today, I had some free time, so I decided to try using Vercel Edge instead and share my findings with those who are interested.</p>
<p>The official version of Vercel also supports image processing, but it has a limit of 1000 original images per month and only supports scaling. By using Vercel Edge to process images, you can have additional features such as scaling, cropping, watermarking, and filters. However, please note that the free version of Vercel only allows for 100GB of monthly traffic, so it is recommended to use it in conjunction with a CDN for actual usage.</p>
<p>Supported features:</p>
<ol>
<li>Support for processing PNG, JPG, BMP, ICO, and TIFF format images</li>
<li>Output images in JPG, PNG, and WEBP formats, with WEBP being the default</li>
<li>Support for pipelining, allowing for multiple operations to be performed</li>
<li>Support for whitelisting image URLs to prevent abuse</li>
<li>Graceful degradation in case of processing failure, returning the original image (exceptions are not cached)</li>
</ol>
<h2 id="demo">Demo</h2>
<h3 id="format-conversion">Format Conversion</h3>
<h4 id="webp">WEBP</h4>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;format=webp" alt="webp"></p>
<h4 id="jpg">JPG</h4>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;format=jpg" alt="jpg"></p>
<h4 id="png">PNG</h4>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;format=png" alt="png"></p>
<h3 id="scaling">Scaling</h3>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;action=resize!830,400,2" alt="resize"></p>
<h3 id="rotation">Rotation</h3>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;action=rotate!90" alt="rotate"></p>
<h3 id="cropping">Cropping</h3>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;action=crop!0,0,1000,1000" alt="rotate"></p>
<h3 id="filters">Filters</h3>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;action=filter%21obsidian" alt="filter"></p>
<h3 id="image-watermark">Image Watermark</h3>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;action=watermark!https%3A%2F%2Fstatic.miantiao.me%2Fshare%2F6qIq4w%2FFhSUzU.png,20,20" alt="watermark"></p>
<h3 id="text-watermark">Text Watermark</h3>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;action=draw_text!miantiao.me,20,20" alt="draw_text"></p>
<h3 id="pipelining">Pipelining</h3>
<h4 id="scaling--rotation--text-watermark">Scaling + Rotation + Text Watermark</h4>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;action=resize!830,400,2%7Crotate!180%7Cdraw_text!miantiao.me,10,10" alt="resize &#x26; rotate &#x26; draw_text"></p>
<h4 id="scaling--image-watermark">Scaling + Image Watermark</h4>
<p><img src="https://edge-image.miantiao.me/?url=https%3A%2F%2Fstatic.miantiao.me%2Fshare%2FMTyerw%2Fbanner-2048.jpeg&#x26;action=resize!830,400,2%7Cwatermark!https%3A%2F%2Fstatic.miantiao.me%2Fshare%2F6qIq4w%2FFhSUzU.png,10,10" alt="resize &#x26; watermark"></p>
<p>In theory, it supports various operations available in Photon. If you are interested, you can check the image URLs and modify the parameters according to the <a href="https://docs.rs/photon-rs/latest/photon_rs/">Photon documentation</a> to try it out yourself. If you encounter any issues, please leave a comment and provide feedback.</p>
<h2 id="sharing">Sharing</h2>
<p>I have open-sourced this solution on my GitHub repository, and you can deploy it by following the documentation.</p>
<p><a href="https://github.com/ccbikai/vercel-edge-image"><img src="https://github.html.zone/ccbikai/vercel-edge-image" alt="ccbikai/vercel-edge-image - GitHub"></a></p>
<hr>
<p><a href="https://www.buymeacoffee.com/ccbikai"><img src="https://static.miantiao.me/share/0WmsVP/CcmGr8.png" alt="Buy Me A Coffee"></a></p>